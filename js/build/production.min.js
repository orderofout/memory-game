var d,Database={settings:{dbName:"memoryGame",dbVersion:"1.0",dbDesc:"Leaderboard Results",dbSize:5242880,results:[],currentUserId:!1},init:function(){return d=Database.settings,Database.db=window.openDatabase(d.dbName,d.dbVersion,d.dbDesc,d.dbSize),Database.db?(Database.exec("CREATE TABLE IF NOT EXISTS userResults (id INTEGER PRIMARY KEY AUTOINCREMENT, firstName TEXT, lastName TEXT, completionTime INTEGER, score INTEGER, attempts INTEGER)",[]),void 0):(console.error("DB was not created"),!1)},cb:{onReadyTransaction:function(){console.log("Transaction completed")},onSuccessExecuteSql:function(a,b){console.log("Execute SQL completed: "+b.insertId),d.currentUserId=b.insertId},onSuccessSql:function(){console.log("Update SQL completed")},onError:function(a){console.log(a)}},exec:function(a,b,c,d){var e=this;e.db.transaction(function(e){e.executeSql(a,b,function(a,b){for(var e=[],f=0;f<b.rows.length;++f)e.push(b.rows.item(f));c&&c(e,b,d)},Database.cb.onError)})},displayResults:function(a,b){if(0===b.rows.length)return console.error("No records found"),!1;for(var c=[],e=0;e<b.rows.length;e++)c.push(b.rows.item(e));d.results=c}};!function(){Database.init()}();var g,GamePlay={settings:{gameDuration:8e4,pointValuePair:1e3,pointValueSeconds:100,overEightAttemptsPenalty:50,currentPoints:0,selected:[],totalPairs:0,numAttempts:0,numCorrect:0,div:$('<div class="col-xs-3">'),row:$('<div class="row">'),body:$("body"),cardRows:$("#gameHolder .row"),cardContainer:$(".col-xs-3"),timeDisplay:$("#timeRemaining"),pointsDisplay:$("#userPoints"),userNameDisplay:$("#userName strong"),cardFrontHolder:$("<div>"),cardFront:"../img/card-front-255x255.png",cardBacks:[{id:"a",src:"http://dummyimage.com/255x255/8A2BE2/fff&text=a"},{id:"b",src:"http://dummyimage.com/255x255/DC143C/fff&text=b"},{id:"c",src:"http://dummyimage.com/255x255/556B2F/fff&text=c"},{id:"d",src:"http://dummyimage.com/255x255/1E90FF/fff&text=d"},{id:"e",src:"http://dummyimage.com/255x255/FF8C00/fff&text=e"},{id:"f",src:"http://dummyimage.com/255x255/BA55D3/fff&text=f"},{id:"g",src:"http://dummyimage.com/255x255/000080/fff&text=g"},{id:"h",src:"http://dummyimage.com/255x255/FF4500/fff&text=h"}]},init:function(){var a=GamePlay.getUrlParameter("uid");if("null"===a)return alert("You must be logged in to play this game"),window.location="/",!1;g=GamePlay.settings,GamePlay.startTimer(),g.totalPairs=g.cardBacks.length;g.cardBacks;g.cardBacks=g.cardBacks.concat(g.cardBacks);var b=(GamePlay.shuffle(g.cardBacks),0);g.cardRows.each(function(a){var c=this;$(c).children(".col-xs-3").each(function(c){var d=$(this);d.attr("data-id",g.cardBacks[b].id+a+"-"+c),d.attr("data-back",g.cardBacks[b].src),d.html('<a href="#" class="thumbnail unselected"><img src="'+g.cardFront+'" width="100%" /></a>'),b++})}),GamePlay.bindUIActions(),GamePlay.displayUserName()},bindUIActions:function(){g.cardContainer.on("click",function(a){a.preventDefault(),console.log($(this).attr("data-id"));var b=$(this).attr("data-back"),c=$(this).attr("data-front"),d=$(this).children().children(),e=$(this).attr("data-id");"disabled"!==$(d).attr("data-status")&&("selected"!==$(d).attr("data-status")?($(d).attr("src",b).attr("data-status","selected"),g.selected.push(e)):($(d).attr("src",c).attr("data-status","false"),g.selected.pop(e))),2==g.selected.length&&(console.log(g.selected),g.numAttempts++,g.selected[0].substr(0,1)!==g.selected[1].substr(0,1)?window.setTimeout(function(){console.log("reseting selections"),$(".col-xs-3 img").each(function(a,b){"disabled"!==$(b).attr("data-status")&&$(b).attr("src",g.cardFront).attr("data-status","false")})},500):(console.log("matching pair"),$('.col-xs-3[data-id="'+g.selected[0]+'"] img').attr("data-status","disabled"),$('.col-xs-3[data-id="'+g.selected[1]+'"] img').attr("data-status","disabled"),g.totalPairs--,GamePlay.addPointValue(g.pointValuePair,!1)),console.log("total attempts: "+g.numAttempts),g.selected=[],GamePlay.isGameOver())}),g.cardContainer.on("dragstart","img",function(a){a.preventDefault()})},startTimer:function(){Tock.wind(function(){g.cardBacks.length/2-g.totalPairs;alert("Time's Up - it took you "+g.numAttempts+" attempts to get "+g.numCorrect+" pairs correct"),g.timeDisplay.html("0:00s"),Tock.unwind("timeDisplayInt"),GamePlay.saveUserResults()},g.gameDuration,"appTimer"),GamePlay.timeRemaining(),console.log("timer is running")},endTimer:function(){var a=Tock.secondsLeft("appTimer");return Tock.unwindAll(),a},isGameOver:function(){if(0===g.totalPairs){var a=GamePlay.endTimer();$("#gameHolder").animate({opacity:0},250,function(){GamePlay.addPointValue(a,!0),GamePlay.addPointValue(-Math.abs((g.numAttempts-8)*g.overEightAttemptsPenalty),!1);var b="<tr><td>Attempts</td><th>"+g.numAttempts+"</th></tr>";b+="<tr><td># of Seconds Remaining</td><th>"+a+"</th></tr>",b+="<tr><td>Total Points</td><th>"+g.currentPoints+"</th></tr>",$("#gameHolder").html("<h2>"+g.userNameDisplay.text()+'</h2><table class="table table-bordered table-striped"><tbody>'+b+"</tbody</table>").css({opacity:1}),GamePlay.saveUserResults()})}},shuffle:function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},timeRemaining:function(){Tock.windInterval(function(){var a=Tock.secondsLeft("appTimer"),b=Math.floor(a/60),c=a-60*b;0===b&&30===c&&g.timeDisplay.removeClass("label-success").addClass("label-danger"),c.toString().length<2&&(c="0"+c.toString()),g.timeDisplay.html(b+":"+c+"s")},1e3,"timeDisplayInt")},addPointValue:function(a,b){var c=g.currentPoints;console.log("curPts: "+g.currentPoints+" | Adding Value: "+a+" | isMultiply: "+b),c+=b?g.pointValueSeconds*a:a,g.currentPoints=c,g.pointsDisplay.html(g.currentPoints+"pts"),console.log("curPts: "+g.currentPoints)},displayPointValue:function(a,b){"correctPair"==pointType?(g.currentPoints=g.currentPoints+g.pointValuePair,g.pointsDisplay.html(g.currentPoints+"pts")):(g.currentPoints+=pointType*g.pointValueSeconds,g.pointsDisplay.html(g.currentPoints+"pts"));var c=g.currentPoints;b?c*=a:c+=a,g.currentPoints=c,g.pointsDisplay.html(g.currentPoints+"pts")},saveUserResults:function(){var a=GamePlay.getUrlParameter("uid"),b=g.pointsDisplay.text().substr(0,g.pointsDisplay.text().length-3),c=g.timeDisplay.text().substr(0,g.timeDisplay.text().length-1),d=c.split(":"),e=6e4*d[0]+1e3*d[1],f=g.gameDuration-e,h=f%1e3;f=(f-h)/1e3;var i=f%60;f=(f-i)/60;var j=f%60;return a&&"null"!==a&&""!==a?(Database.exec("update userResults set completionTime = ?, score = ?, attempts = ? where id = ?",[j+":"+i,b,g.numAttempts.toString(),a],function(){console.log("saved")},[]),void 0):(alert("Username not found, your game will not be saved."),!1)},getUrlParameter:function(a){return decodeURI((RegExp(a+"=(.+?)(&|$)").exec(location.search)||[,null])[1])},displayUserName:function(){var a=GamePlay.getUrlParameter("uid");return a&&"null"!==a&&""!==a?(Database.exec("select firstName, lastName from userResults where id = ?",[a],function(a){g.userNameDisplay.html(a[0].firstName+" "+a[0].lastName).fadeIn()},[]),void 0):(alert("Username not found, your game will not be saved."),!1)},showAllCards:function(){g.cardContainer.each(function(){{var a=$(this).attr("data-back"),b=($(this).attr("data-front"),$(this).children().children());$(this).attr("data-id")}"disabled"!==$(b).attr("data-status")&&$(b).attr("src",a).attr("data-status","selected")}),Tock.wind(function(){g.cardContainer.each(function(){{var a=$(this).children().children();$(this).attr("data-front")}console.log($(this)),"disabled"!==$(a).attr("data-status")&&$(a).attr("src",g.cardFront).attr("data-status","false")})},500,"showAllReset")}},lb,Leaderboard={settings:{topNumUsers:10,roster:[],leaderboardHolder:$(".col-xs-12 table tbody")},init:function(){console.log("Leaderboard Created"),lb=Leaderboard.settings,Leaderboard.getTopUsers()},bindUIAction:function(){},getTopUsers:function(){Database.exec("select * from userResults order by score desc limit "+lb.topNumUsers,[],function(a){console.log(a),lb.roster=a,Leaderboard.createTable()},[])},createTable:function(){for(var a=0;a<lb.roster.length;a++){var b="<tr>";b+="<td>"+(a+1)+"</td>",b+="<td>"+lb.roster[a].firstName+" "+lb.roster[a].lastName+"</td>",b+="<td>"+lb.roster[a].score+"pts</td>",b+="<td>"+lb.roster[a].completionTime+"s</td>",b+="<td>"+lb.roster[a].attempts+"</td>",b+="</tr>",lb.leaderboardHolder.append(b)}}};!function(){Leaderboard.init()}();var s,StartScreen={settings:{playBtn:$("#playBtn"),firstName:$('input[name="firstName"]'),lastName:$('input[name="lastName"]')},init:function(){s=StartScreen.settings,StartScreen.bindUIActions(),console.log("Start Screen")},bindUIActions:function(){s.playBtn.on("click",function(a){a.preventDefault(),StartScreen.createUserEntry()})},createUserEntry:function(){return""===s.firstName.val()&&""===s.lastName.val()?(console.error("User fields are blank"),!1):(Database.exec("INSERT INTO userResults(firstName, lastName) VALUES(?, ?)",[s.firstName.val(),s.lastName.val()],function(a,b){console.log(b.insertId),$(".container h2").text("Loading game..."),$("form").fadeOut(),window.location="/game.html?uid="+b.insertId},[]),void 0)}};!function(){StartScreen.init()}();